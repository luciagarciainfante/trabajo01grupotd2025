---
title: "Trabajo 1. Teoría de la Decisión. Enunciados y soluciones"
author: "Grupo 3. Lucía García Infante, Rosa Fernandez López, Sergio Pacheco Márquez, Víctor Silva Nieves"
format: 
  html:
    toc: true
    toc-depth: 3
    toc-expand: true
    toc-location: left
    code-fold: false
    theme:
      - cosmo
      - estilo/tema.scss
  typst: 
    toc: true
    toc-depth: 3
    include-before-body: estilo/toc-sep.typ
    code-fold: false
    brand: _brand.yml"
lang: es
---


```{r}

# Cargar librerías necesarias
library(tinytable)

# Cargar script con funciones
source("teoriadecision_funciones_incertidumbre.R")

# Preparar tema propio para tablas
colores <- hcl.colors(5, palette = "Berlin")

crea_vector_posiciones_tabla <- function(numero_columnas) {
  posiciones <- ""
  for(i in 1:numero_columnas) {
    posiciones <- paste0(posiciones,"c")
  }
  return(posiciones)
}

crea_tabla_estilo <- function(tabla, nombresfila = TRUE) {

  if (nombresfila == TRUE) {
    rn <- rownames(tabla)
    if (is.null(rn)) rn <- rep("", nrow(tabla))
    tabla <- cbind(rn = rn, tabla, stringsAsFactors = FALSE)
    colnames(tabla)[1] <- ""   
    rownames(tabla) <- NULL 
  }

  t <- tt(tabla, theme = "empty", width=1) |>
    format_tt(quarto=TRUE) |>
    style_tt(j = 1:ncol(tabla), align = crea_vector_posiciones_tabla(ncol(tabla)), alignv = "m") |>
    style_tt(i = 0, line = "b", line_color = colores[2], line_width = 0.2,
    background = colores[5], color = colores[3]) |> 
    style_tt(i = 0, line = "t", line_color = colores[1], line_width = 0.1) |> 
    style_tt(i = 1:nrow(tabla), line = "b", line_color = colores[1], line_width = 0.1) |> style_tt(j = 1:(ncol(tabla)-1), line = "r", line_color = colores[1], line_width = 0.1)

  return(t)
}

```


# EJERCICIO 1. Lucía García Infante.

## Prolema 1.1

Aplicar los criterios de decisión bajo incertidumbre al siguiente problema considerando una situación favorable (beneficios) y desfavorable (costos)

|    | e1  | e2  | e3  | e4  | e5  | e6  |
|----|-----|-----|-----|-----|-----|-----|
| d1 | 100 | 200 | 130 | 150 | 240 | 100 |
| d2 | 300 | 145 | 230 | 345 | 200 | 280 |
| d3 | 120 | 300 | 260 | 400 | 100 | 330 |
| d4 | 180 | 130 | 300 | 370 | 280 | 190 |
| d5 | 200 | 140 | 135 | 280 | 190 | 100 |



### Apartado a. Tabla correspondiente a beneficios. 

```{r}
tb01a = crea.tablaX(c(100,200,130,150,240,100,
                      300,145,230,345,200,280,
                      120,300,260,400,100,330,
                      180,130,300,370,280,190,
                      200,140,135,280,190,100),
                    numalternativas = 5, numestados = 6)
```
\pagebreak

#### **1. Método de Wald**

Para cada alternativa se supone que va a pasar lo peor, y elige aquella alternativa que dé mejor valor.

```{r}
b1 = criterio.Wald(tb01a,favorable=TRUE)
names(b1$AlternativaOptima)
```


#### **2. Método Optimista**

Para cada alternativa se supone que pasará lo mejor, y se elige laa que dé mejor valor. 
```{r}
b2 = criterio.Optimista(tb01a,favorable = TRUE)
names(b2$AlternativaOptima)
```

#### **3. Método Hurwicz**

Combina optimismo y pesimismo usando un coeficiente de optimismo $\alpha$:

$$
\text{Valor Hurwicz} = \alpha \cdot \max + (1-\alpha) \cdot \min
$$
Resolvemos considerando $\alpha$ = 0.5.
```{r}
b3 = criterio.Hurwicz(tb01a,alfa=0.5,favorable=TRUE)
names(b3$AlternativaOptima)
```

Ahora vamos a hacer un análisis de la decisiones en función del $\alpha$. Para ello disponemos de dos funciones, una que te hace la gráfica, y otra que además te da los intervalos. Usamos la completa: 
```{r}
dibuja.criterio.Hurwicz_Intervalos(tb01a,T)
```

:::{.callout-tip}
### Interpretación: 
Para valores de $\alpha$ entre 0 y 0.375, se elegirá la alternativa 2. 
Para valores entre 0.375 y 0.5 se elegirá la alternativa 4. 
Para valores entre 0.5 1, elegiremos la 3.

Vemos que efectivamente tenemos el mismo resultado que el obtenido al principio. 
Justo el $\alpha$ = 0.5 es el punto de corte entre las rectas. Por eso nos salen dos alternativas.
:::


#### **4. Método Savage**

Minimiza el arrepentimiento máximo comparando lo que se pudo ganar y lo que se ganó.

```{r}
b4 = criterio.Savage(tb01a,favorable=TRUE)
names(b4$AlternativaOptima)
```


#### **5. Método Laplace**

Asume que todos los estados son igualmente probables y elige la alternativa con mayor promedio.

```{r}
b5 = criterio.Laplace(tb01a,favorable=TRUE)
names(b5$AlternativaOptima)
```


#### **6. Método Punto Ideal**
Considera un resultado perfecto y mide la distancia de cada alternativa a ese ideal, eligiendo la más cercana.
```{r}
b6 = criterio.PuntoIdeal(tb01a,favorable=TRUE)
names(b6$AlternativaOptima)
```


:::{.callout-tip}
### Conclusiones: 
Tomando los datos de la tabla como beneficios, los resultados que obtenemos son: La decisión 1 y la 5 no se eligen en ningún método. La 2 y la 3 empatan siendo elegidas por 3 métodos. Y la decisión 4 sólo aparece en 1. 
Por tanto, las mejores decisiones en este caso son la 2 y la 3.
:::

\pagebreak

### Apartado b. Tabla correspondiente a costes. 

#### **1. Método de Wald**

Para cada alternativa se supone que va a pasar lo peor, y elige aquella alternativa que dé mejor valor.

```{r}
c1 = criterio.Wald(tb01a,favorable=FALSE)
names(c1$AlternativaOptima)
```

#### **2. Método Optimista**

Para cada alternativa se supone que pasará lo mejor, y se elige laa que dé mejor valor. 

```{r}
c2 = criterio.Optimista(tb01a,favorable = FALSE)
names(c2$AlternativaOptima)
```

#### **3. Método Hurwicz**

Combina optimismo y pesimismo usando un coeficiente de optimismo $\alpha$:

$$
\text{Valor Hurwicz} = \alpha \cdot \max + (1-\alpha) \cdot \min
$$

```{r}
c3 = criterio.Hurwicz(tb01a,alfa=0.5,favorable=FALSE)
names(c3$AlternativaOptima)
```

```{r}
dibuja.criterio.Hurwicz(tb01a, FALSE)
```


:::{.callout-tip}
### Interpretación: 
En este caso, por estar en el caso de costes, debemos mirar la línea más baja. Vemos que para cualquier nivel de alpha, la decisión elegida es la d1. 
Vemos que efectivamente tenemos el mismo resultado que el obtenido al principio. 
:::


#### **4. Método Savage**

Minimiza el arrepentimiento máximo, que se calcula a partir del coste extra que se podría haber evitado.

```{r}
c4 = criterio.Savage(tb01a,favorable=FALSE)
names(c4$AlternativaOptima)
```

#### **5. Método Laplace**

Calcula el promedio de costes suponiendo igual probabilidad para cada estado.

```{r}
c5 = criterio.Laplace(tb01a,favorable=FALSE)
names(c5$AlternativaOptima)
```


#### **6. Método Punto Ideal**

Compara la distancia a un coste ideal mínimo, eligiendo el más cercano al ideal (menor coste).
```{r}
c6 = criterio.PuntoIdeal(tb01a,favorable=FALSE)
names(c6$AlternativaOptima)
```


:::{.callout-tip}
### Conclusiones: 
Tomando los datos de la tabla como costes, los resultados que obtenemos son: La decisión 2 y la 4 no se eligen en ningún método. La 3 es elegida una única vez y la 5, dos veces. La decisión 1 es la que más veces es elegida por 5 métodos. 

Por tanto, la mejor decisión en este caso es la 1.
:::


\pagebreak



## Problema 1.2

Marina es una alumna del grado en Estadística que acaba este año. El próximo año quiere realizar un máster para mejorar sus oportunidades laborales, pero solo puede escoger uno.
Todavía no sabe en qué sitio empezará a trabajar aunque considera tres posibilidades:

- Una **empresa privada en el extranjero**.
- Una **institución pública**.
- Una **empresa privada española**.

Para decidir, Marina ha mirado tres másteres que le interesan y ha estimado cuál podría ser su primer sueldo anual según el tipo de empresa, junto con el coste de cada máster:

- **Máster en Análisis de Datos**. Espera ganar unos 26.000 € en una empresa extranjera, 18.000 € en una institución pública y 20.000 € en una empresa española. Este máster tiene un coste de 10.000 €.
- **Máster en Programación y Modelos Estadístico**. Estima que su sueldo inicial sería de 20.000 € en una empresa extranjera, 12.000 € en una institución pública y 20.000 € en una empresa privada española. El coste de este máster asciende a 6.500 €.
- **Máster en Comunicación y Gestión de Proyectos**. Espera un sueldo de 10.000 € en una empresa extranjera, 12.000 € en una institución pública y 20.000 € en una empresa privada española. Este máster tiene un coste de 3.000 €.


### Planteamiento del problema

- Un decisor: Marina.
- Modelo de beneficios (favorable).
- Alternativas:
  - A1 = Máster en Análisis de Datos
  - A2 = Máster en Programación y Modelos Estadísticos
  - A3 = Máster en Comunicación y Gestión de Proyectos
- Estados de la naturaleza:
  - E1 = Empresa extranjera
  - E2 = Institución pública
  - E3 = Empresa privada española
- Matriz de decisión:  Beneficios = Sueldo esperado - Coste máster

### Solución del problema

```{r}
# Máster en Análisis de Datos
m11 = 26000 - 10000   # Empresa extranjera
m12 = 18000 - 10000   # Institución pública
m13 = 20000 - 10000   # Empresa española

# Máster en Programación y Modelos Estadísticos
m21 = 20000 - 6500  # Empresa extranjera
m22 = 12000 - 6500  # Institución pública
m23 = 20000 - 6500  # Empresa españolaA

# Máster en Comunicación y Gestión de Proyectos
m31 = 10000 - 3000  # Empresa extranjera
m32 = 12000 - 3000  # Institución pública
m33 = 20000 - 3000  # Empresa española

```

Inserto los datos en la tabla: 
```{r}
tb02 = crea.tablaX(c(m11,m12,m13,
                     m21,m22,m23,
                     m31,m32,m33),
    numalternativas = 3, numestados = 3,
    nb_alternativas = c("A1","A2","A3"),
    nb_estados = c("E1","E2","E3"))

tb02
```

\pagebreak

Aplico la función que devuelve todos los métodos en una única tabla: 

```{r}
sol02 = criterio.Todos(tb02, alfa=0.5, favorable=TRUE)
sol02
```

:::{.callout-tip}
### Conclusiones: 
La alternativa A1 es la opción más recomendada, ya que resulta óptima en la mayoría de los criterios (3 veces).

Por tanto, Marina debería estudiar el próximo año el Máster en Análisis de Datos.
:::


\pagebreak


# EJERCICIO 2. Rosa Fernández López.

## Prolema 2.1

Aplicar los criterios de decisión bajo incertidumbre (tanto en situación favorable
como desfavorable) a los problemas cuya matriz de valores numéricos viene dada en la tabla siguiente:

|  | e1 | e2 | e3 |
|:------|:----:|:----:|:----:|
| **d1**| 12 | 8  | 5  |
| **d2**| 10 | 11 | 4  |
| **d3**| 7  | 13 | 6  |

### Apartado a. Tabla correspondiente a beneficios.

Matriz de datos
```{r}
m1 <- crea.tablaX(c(12, 8, 5,
               10, 11, 4,
               7, 13, 6),
             numalternativas = 3, numestados = 3)
rownames(m1) <- c("d1", "d2", "d3")
colnames(m1) <- c("e1", "e2", "e3")
m1
```


Aplicar criterios en situaciones favorables
```{r}
# Criterio de Wald (pesimista)
sol_W <- criterio.Wald(m1, favorable = TRUE)
cat("La decisión óptima en el Criterio de Wald (pesimista) es: ",
    sol_W$AlternativaOptima)

# Criterio Optimista (Maximax)
sol_O <- criterio.Optimista(m1, favorable = TRUE)
cat("La decisión óptima en el Criterio Optimista (Maximax) es: ",
    sol_O$AlternativaOptima)

# Criterio de Hurwicz
sol_H <- criterio.Hurwicz(m1, favorable = TRUE, alfa = 0.5)
cat("La decisión óptima en el Criterio de Hurwicz es: ",
    sol_H$AlternativaOptima)

# Criterio de Savage (Minimax)
sol_S <- criterio.Savage(m1, favorable = TRUE)
cat("La decisión óptima en el Criterio de Savage (Minimax) es: ",
    sol_S$AlternativaOptima)

# Criterio de Laplace
sol_L <- criterio.Laplace(m1, favorable = TRUE)
cat("La decisión óptima en el Criterio de Laplace es: ",
    sol_L$AlternativaOptima)

# Criterio de Punto Ideal
sol_PI <- criterio.PuntoIdeal(m1, favorable = TRUE)
cat("La decisión óptima en el Criterio de Punto Ideal es: ",
    sol_PI$AlternativaOptima)

# Todos los criterios juntos
sol_T <- criterio.Todos(m1, favorable = TRUE, alfa = 0.5)
library(tinytable)
tt(sol_T, rownames = TRUE)

```


Resultados en situación favorable
```{r}
dibuja.criterio.Hurwicz(m1, favorable = TRUE)
```

```{r}
# Extraer la fila "iAlt.Opt" de la tabla
optimas <- sol_T["iAlt.Opt", ]

# Contar cuántas veces aparece cada alternativa
conteo <- table(as.character(optimas))

# Identificar la más frecuente
mayoria <- names(which.max(conteo))

# Mostrar el resultado
cat("Según la mayoría de criterios en situación favorable, la alternativa óptima es:", mayoria, "\n")


```

### Apartado b. Tabla correspondiente a costes.

Aplicar criterios en situación desfavorable
```{r}
# Criterio de Wald (pesimista)
sol_W_d <- criterio.Wald(m1, favorable = FALSE)
cat("La decisión óptima en el Criterio de Wald (pesimista) es: ",
    sol_W_d$AlternativaOptima)

# Criterio Optimista
sol_O_d <- criterio.Optimista(m1, favorable = FALSE)
cat("La decisión óptima en el Criterio Optimista es: ",
    sol_O_d$AlternativaOptima)

# Criterio de Hurwicz
sol_H_d <- criterio.Hurwicz(m1, favorable = FALSE, alfa = 0.5)
cat("La decisión óptima en el Criterio de Hurwicz es: ",
    sol_H_d$AlternativaOptima)

# Criterio de Savage
sol_S_d <- criterio.Savage(m1, favorable = FALSE)
cat("La decisión óptima en el Criterio de Savage es: ",
    sol_S_d$AlternativaOptima)

# Criterio de Laplace
sol_L_d <- criterio.Laplace(m1, favorable = FALSE)
cat("La decisión óptima en el Criterio de Laplace es: ",
    sol_L_d$AlternativaOptima)

# Criterio de Punto Ideal
sol_PI_d <- criterio.PuntoIdeal(m1, favorable = FALSE)
cat("La decisión óptima en el Criterio de Punto Ideal es: ",
    sol_PI_d$AlternativaOptima)

# Todos los criterios juntos
sol_T_d <- criterio.Todos(m1, favorable = FALSE, alfa = 0.5)
library(tinytable)
tt(sol_T_d, rownames = TRUE)

```


Resultados en situación desfavorable
```{r}
dibuja.criterio.Hurwicz(m1, favorable = FALSE)
```
```{r}

# Extraer la fila "iAlt.Opt (Desfav.)" de la tabla
optimasdesf <- sol_T_d["iAlt.Opt (Desfav.)", ]

# Contar cuántas veces aparece cada alternativa
conteodesf <- table(as.character(optimasdesf))

# Identificar la más frecuente
mayoriadesf <- names(which.max(conteodesf))

# Mostrar el resultado
cat("Según la mayoría de criterios en situación desfavorable, la alternativa óptima es:", mayoriadesf, "\n")


```



\pagebreak


## Prolema 2.2

**Elección de tarifa eléctrica para un nuevo piso**

Carlos se ha mudado recientemente a un nuevo piso y necesita contratar una tarifa de electricidad. Tras comparar varias compañías, ha identificado tres opciones con condiciones distintas:

- ElectroPlus ofrece una tarifa fija de 45€ al mes, independientemente del consumo eléctrico.

- LuzFlex aplica una tarifa variable de 0,20€/kWh, con una cuota base mensual de 15€.

- EcoVolt propone una tarifa variable de 0,15€/kWh sin cuota fija, pero incluye una penalización de 10€ si el consumo mensual supera los 300kWh.

Carlos no tiene certeza sobre su consumo mensual, pero considera dos escenarios posibles durante el primer año:

- Consumo moderado: 250kWh al mes.

- Consumo elevado: 350kWh al mes.

Determinar cuál sería la mejor opción para Carlos según cada criterio.

### Planteamiento del problema
Cálculo de costes anuales por alternativa y escenario

```{r}
# ElectroPlus: tarifa fija
electroplus_moderado <- 45 * 12
electroplus_elevado  <- 45 * 12

# LuzFlex: tarifa variable + cuota fija
luzflex_moderado <- (250 * 0.20 + 15) * 12
luzflex_elevado  <- (350 * 0.20 + 15) * 12

# EcoVolt: tarifa variable + penalización si > 300kWh
ecovolt_moderado <- 250 * 0.15 * 12
ecovolt_elevado  <- (350 * 0.15 + 10) * 12
```

### Solución del problema

Crear la matriz de costes

```{r}
m_carlos <- crea.tablaX(c(electroplus_moderado, electroplus_elevado,
                          luzflex_moderado, luzflex_elevado,
                          ecovolt_moderado, ecovolt_elevado),
                        numalternativas = 3,
                        numestados = 2)

rownames(m_carlos) <- c("ElectroPlus", "LuzFlex", "EcoVolt")
colnames(m_carlos) <- c("Consumo moderado", "Consumo elevado")
m_carlos

```

Aplicar criterios en situación desfavorable (costes)

```{r}

sol_carlos <- criterio.Todos(m_carlos, favorable = FALSE, alfa = 0.5)

# Mostrar tabla de resultados
library(tinytable)
tt(sol_carlos, rownames = TRUE)

```

Resultados en situación desfavorable

```{r}
# Extraer la fila de alternativas óptimas
optimas <- sol_carlos["iAlt.Opt", ]
mayoria <- names(which.max(table(as.character(optimas))))

cat("Según la mayoría de criterios, la mejor tarifa para Carlos sería:", mayoria, "\n")
```

```{r}
dibuja.criterio.Hurwicz(m_carlos, favorable = FALSE)
dibuja.criterio.Hurwicz_Intervalos(m_carlos, favorable = FALSE)
```


:::{.callout-tip}
### Conclusiones:
Observando el gráfico, vemos que:

 - ElectroPlus (línea roja) mantiene un coste constante para cualquier valor de alpha.

 - LuzFlex (línea verde) tiene un coste intermedio, que disminuye ligeramente al aumentar alpha.

 - EcoVolt (línea azul) es la más sensible al valor de alpha: si alpha es bajo (más pesimista), su coste es alto; si alpha es alto (más optimista), su coste baja considerablemente.

 Esto indica que EcoVolt solo sería recomendable si Carlos adopta una actitud muy optimista respecto al consumo.

El punto de corte entre las alternativas ElectroPlus y EcoVolt es 0.7
:::


\pagebreak
 

# EJERCICIO 3. Sergio Pacheco Márquez.

## Problema 3.1

Una empresa de tecnología debe escoger la estrategia de lanzamiento de un nuevo dispositivo.\
Las alternativas son:

-   **E1:** Lanzamiento enfocado en publicidad en redes sociales.\
-   **E2:** Lanzamiento con campaña televisiva nacional.\
-   **E3:** Lanzamiento mixto (online + medios tradicionales).

El resultado económico (beneficio en miles de euros) depende del estado del mercado:\
**S1** (Alta demanda), **S2** (Demanda media) y **S3** (Baja demanda).

Se dispone de la siguiente tabla de pagos (beneficios en miles de euros):

```{r}
# Creamos la matriz de pagos (en miles de euros)
matriz_pagos <- matrix(c(
  80, 40, 10,   # E1
  100, 50, -20, # E2
  70, 60, 30    # E3
), 
nrow = 3,
byrow = TRUE)

# Convertimos la matriz en un data frame
tabla_pagos <- as.data.frame(matriz_pagos)

# Asignamos nombres de columnas (estados de la naturaleza)
colnames(tabla_pagos) <- c("S1", "S2", "S3")

# Asignamos nombres de filas (estrategias)
rownames(tabla_pagos) <- c("E1", "E2", "E3")

# Mostramos la tabla con estilo
crea_tabla_estilo(tabla_pagos, TRUE)

```

1.Definimos la tabla de pagos (beneficios en miles de euros)

```{r}
vector_pagos <- c(80,40,10,
                  100,50,-20,
                  70,60,30)

tablaX <- crea.tablaX(
  vector_matporfilas = vector_pagos,
  numalternativas = 3,
  numestados = 3,
  nb_alternativas = c("E1_Redes", "E2_TV", "E3_Mixta"),
  nb_estados = c("Alta", "Media", "Baja")
)

tablaX
```

### Situación favorable

```{r}
wald_fav     <- criterio.Wald(tablaX, favorable = TRUE)
optimista_fav <- criterio.Optimista(tablaX, favorable = TRUE)
hurwicz_fav  <- criterio.Hurwicz(tablaX, alfa = 0.6, favorable = TRUE)
laplace_fav  <- criterio.Laplace(tablaX, favorable = TRUE)
savage_fav   <- criterio.Savage(tablaX, favorable = TRUE)
puntoideal_fav <- criterio.PuntoIdeal(tablaX, favorable = TRUE)
```

Mostrar resultados

```{r}
cat("### Resultados (Situación Favorable)\n")
cat("Wald: ", wald_fav$AlternativaOptima, "\n")
cat("Optimista: ", optimista_fav$AlternativaOptima, "\n")
cat("Hurwicz: ", hurwicz_fav$AlternativaOptima, "\n")
cat("Laplace: ", laplace_fav$AlternativaOptima, "\n")
cat("Savage: ", savage_fav$AlternativaOptima, "\n")
cat("Punto Ideal: ", puntoideal_fav$AlternativaOptima, "\n")
```

### Situacion desfavorable

```{r}
wald_desf     <- criterio.Wald(tablaX, favorable = FALSE)
optimista_desf <- criterio.Optimista(tablaX, favorable = FALSE)
hurwicz_desf  <- criterio.Hurwicz(tablaX, alfa = 0.6, favorable = FALSE)
laplace_desf  <- criterio.Laplace(tablaX, favorable = FALSE)
savage_desf   <- criterio.Savage(tablaX, favorable = FALSE)
puntoideal_desf <- criterio.PuntoIdeal(tablaX, favorable = FALSE)
```

Mostrar resultados

```{r}
cat("### Resultados (Situación Desfavorable)\n")
cat("Wald: ", wald_desf$AlternativaOptima, "\n")
cat("Optimista: ", optimista_desf$AlternativaOptima, "\n")
cat("Hurwicz: ", hurwicz_desf$AlternativaOptima, "\n")
cat("Laplace: ", laplace_desf$AlternativaOptima, "\n")
cat("Savage: ", savage_desf$AlternativaOptima, "\n")
cat("Punto Ideal: ", puntoideal_desf$AlternativaOptima, "\n")
```

Aplicamos la función global 

```{r}
resultado_fav <- criterio.Todos(tablaX, alfa = 0.6, favorable = TRUE)
resultado_desf <- criterio.Todos(tablaX, alfa = 0.6, favorable = FALSE)


print("### Resumen global situación favorable")
print(resultado_fav)


print("### Resumen global situación desfavorable")
print(resultado_desf)
```

### Conclusión

- En la situación favorable, los criterios **Maximax** y **Hurwicz** recomiendan la alternativa **E2** (Publicidad en TV),  
  mientras que **Laplace** y **Punto Ideal** se inclinan por **E3** (Publicidad mixta), que ofrece un equilibrio entre riesgo y beneficio.

- En la situación desfavorable, los criterios **Wald**, **Laplace** y **Savage** recomiendan **E3**,  
  ya que presenta la menor pérdida posible.

- Por tanto, la decisión final recomendada es **E3 (Publicidad mixta)**, por ser la más robusta frente a la incertidumbre.

## Problema 3.2

Una empresa de energías renovables debe decidir la localización de una nueva planta solar fotovoltaica.\
Las alternativas de localización son:

-   **L1:** Andalucía\
-   **L2:** Castilla-La Mancha\
-   **L3:** Aragón

El beneficio proyectado (en millones de euros) depende del nivel de radiación solar anual, que se puede clasificar en tres escenarios posibles:\
**S1** (Alta), **S2** (Media) y **S3** (Baja).

Los beneficios estimados son los siguientes:

```{r}
# Creamos la matriz de pagos (beneficios en miles de euros)
matriz_localizacion <- matrix(c(
  12, 8, 3,   # L1 (Andalucía)
  10, 9, 6,   # L2 (Castilla-La Mancha)
  11, 7, 4    # L3 (Aragón)
),
nrow = 3,
byrow = TRUE)

# Convertimos la matriz en un data frame
tabla_localizacion <- as.data.frame(matriz_localizacion)

# Asignamos nombres de columnas (estados de la naturaleza)
colnames(tabla_localizacion) <- c("S1 (Alta)", "S2 (Media)", "S3 (Baja)")

# Asignamos nombres de filas (localizaciones)
rownames(tabla_localizacion) <- c("L1 (Andalucía)", 
                                  "L2 (Castilla-La Mancha)", 
                                  "L3 (Aragón)")

# Mostramos la tabla con estilo 
crea_tabla_estilo(tabla_localizacion, TRUE)


```


1.Definimos la tabla de pagos (beneficios en millones de euros)

```{r}
vector_pagos2 <- c(12, 8, 3,
                   10, 9, 6,
                   11, 7, 4)

tablaX2 <- crea.tablaX(
  vector_matporfilas = vector_pagos2,
  numalternativas = 3,
  numestados = 3,
  nb_alternativas = c("L1_Andalucía", "L2_CastillaLaMancha", "L3_Aragón"),
  nb_estados = c("Alta", "Media", "Baja")
)

tablaX2
```

Aplicamos la función global

```{r}
resultado_total <- criterio.Todos(tablaX2, alfa = 0.6, favorable = TRUE)
print("### Resumen global Problema 2")
print(resultado_total)
```

### Conclusión

- La tabla resumen obtenida muestra las decisiones recomendadas por cada método.  
  - En este caso, la mayoría de los criterios coinciden en que la mejor alternativa es **L2 (Castilla-La Mancha)**.  
  - Esta localización presenta el mejor equilibrio entre rendimiento medio y riesgo bajo ante la incertidumbre del nivel de radiación solar.

- Por tanto, la decisión final recomendada es **L2: Castilla-La Mancha** como ubicación óptima para la nueva planta solar.

{{< pagebreak >}}

# EJERCICIO 4. Víctor Silva Nieves.

## Problema 4.1

Se deben implementar todos los métodos de decisión bajo incertidumbre, tanto para el caso favorable como para el caso desfavorable (pesimista, optimista, Hurwicz, Savage, Laplace y punto ideal) para la siguiente tabla de decisión:

```{r}
matriz_datos <- matrix(c(5, 15, 8, 18,
                      7, 13, 14, 20,
                      6, 17, 11, 17,
                      4, 14, 16, 16,
                      10, 10, 13, 15),
                    nrow = 5,
                    byrow = TRUE)
tabla_datos <- as.data.frame(matriz_datos)
colnames(tabla_datos) <- c("ω1", "ω2", "ω3", "ω4")
rownames(tabla_datos) <- c("a1", "a2", "a3", "a4", "a5")
crea_tabla_estilo(tabla_datos, TRUE)
```


```{r}
 # Definir la tabla de decisión
 tabla_decision <- crea.tablaX(
                    c(5, 15, 8, 18,
                      7, 13, 14, 20,
                      6, 17, 11, 17,
                      4, 14, 16, 16,
                      10, 10, 13, 15),
                      numalternativas = 5, numestados = 4,
                      nb_alternativas = c("a1", "a2", "a3", "a4", "a5"),
                      nb_estados = c("ω1", "ω2", "ω3", "ω4"))

```

### Caso favorable

#### Método pesimista
```{r}
#| echo: true
alternativa_pesimista <- criterio.Wald(tabla_decision, favorable = TRUE)

```

Para el criterio de `{r} alternativa_pesimista$criterio`, en el caso `{r} alternativa_pesimista$metodo`, la alternativa $`{r} alternativa_pesimista$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} alternativa_pesimista$ValorOptimo`.$

#### Método optimista

```{r}
#| echo: true

alternativa_optimista <- criterio.Optimista(tabla_decision, favorable = TRUE)
```

Para el criterio `{r} alternativa_optimista$criterio`, en el caso `{r} alternativa_optimista$metodo`, la alternativa $`{r} alternativa_optimista$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} alternativa_optimista$ValorOptimo`$.

#### Método Hurwicz

```{r}
#| echo: true

alternativa_Hurwicz <- criterio.Hurwicz(tabla_decision, alfa = 0.5, favorable = TRUE)
alternativas_Hurwicz_alfas <- criterio.Hurwicz.General(tabla_decision, alfa = 10, favorable = TRUE)
tb_Hurwicz <- data.frame(matrix(c(
                  seq(from = 0, to = 1, by = (1/alternativas_Hurwicz_alfas$alfa)),
                  alternativas_Hurwicz_alfas$AlternativaOptima, 
                  alternativas_Hurwicz_alfas$ValorOptimo),
                  nrow = length(alternativas_Hurwicz_alfas$AlternativaOptima), 
                  byrow = FALSE, 
                  ))
colnames(tb_Hurwicz) <- c("Alfa", "Alternativa óptima", "Valor óptimo")

```

Para el criterio de `{r} alternativa_Hurwicz$criterio`, en el caso `{r} alternativa_Hurwicz$metodo`, la alternativa $`{r} alternativa_Hurwicz$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} alternativa_Hurwicz$ValorOptimo`$. Con un valor de $\alpha =$ $`{r} alternativa_Hurwicz$alfa`$.

Se muestra a continuación una tabla con las alternativas óptimas y los valores óptimos para diferentes valores de alfa, que van desde 0 hasta 1 con incrementos de 0.1:

`{r} crea_tabla_estilo(tb_Hurwicz, FALSE)`

Y gráficamente:

```{r}
#| echo: true

gráfico_Hurwicz <- dibuja.criterio.Hurwicz(tabla_decision, favorable = TRUE)
```

Además, se muestra un gráfico donde se pueden apreciar los intervalos de las alternativas óptimas para diferentes valores de alfa:

```{r}
#| echo: true

intervalos_Hurwicz <- dibuja.criterio.Hurwicz_Intervalos(tabla_decision, favorable = TRUE)
```


#### Método Savage

```{r}
#| echo: true

alternativa_Savage <- criterio.Savage(tabla_decision, favorable = TRUE)
```

Para el criterio de `{r} alternativa_Savage$criterio`, en el caso `{r} alternativa_Savage$metodo`, la alternativa $`{r} alternativa_Savage$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} alternativa_Savage$ValorOptimo`$.

#### Método Laplace

```{r}
#| echo: true

alternativa_Laplace <- criterio.Laplace(tabla_decision, favorable = TRUE)
```	

Para el criterio de `{r} alternativa_Laplace$criterio`, en el caso `{r} alternativa_Laplace$metodo`, la alternativa $`{r} alternativa_Laplace$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} alternativa_Laplace$ValorOptimo`$.

#### Método punto ideal

```{r}
#| echo: true

alternativa_puntoideal <- criterio.PuntoIdeal(tabla_decision, favorable = TRUE)
```

Para el criterio de `{r} alternativa_puntoideal$criterio`, en el caso `{r} alternativa_puntoideal$metodo`, la alternativa $`{r} alternativa_puntoideal$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} round(alternativa_puntoideal$ValorOptimo,2)`$.

#### Resumen caso favorable

```{r}
#| echo: true

matriz_resumen_favorable <- matrix(c(
              alternativa_pesimista$criterio,
               alternativa_optimista$criterio,
               alternativa_Hurwicz$criterio,
               alternativa_Savage$criterio,
               alternativa_Laplace$criterio,
               alternativa_puntoideal$criterio,alternativa_pesimista$AlternativaOpt,
               alternativa_optimista$AlternativaOpt,
               alternativa_Hurwicz$AlternativaOpt,
               alternativa_Savage$AlternativaOpt,
               alternativa_Laplace$AlternativaOpt,
               alternativa_puntoideal$AlternativaOpt),
               nrow = 6, byrow = FALSE)

resumen_favorable <- as.data.frame(matriz_resumen_favorable)
colnames(resumen_favorable) <- c("Criterio", "Alternativa óptima")
crea_tabla_estilo(resumen_favorable, FALSE)

```

Vemos que las alternativas óptimas son diferentes según el criterio utilizado, siendo la alternativa $a_2$ la que más veces aparece como óptima (5 veces). Ya alternativa $a_5$ aparece una sola vez como óptima para el criterio pesimista y es la mejor alternativa también para el criterio de Hurwicz con valores de $\alpha$ menores que $`{r} intervalos_Hurwicz$PuntosDeCorte`$ .

::: {.callout-tip}
## Decisión final
En este caso se va a optar por la alternativa $a_2$ dado que es la que mayor número de veces aparece como óptima. En todos los criterios excepto en el persimista.
:::

### Caso desfavorable

#### Método pesimista

```{r}
#| echo: true

alternativa_pesimista_desfavorable <- criterio.Wald(tabla_decision, favorable = FALSE)
```

Para el criterio de `{r} alternativa_pesimista_desfavorable$criterio`, en el caso `{r} alternativa_pesimista_desfavorable$metodo`, la alternativa $`{r} alternativa_pesimista_desfavorable$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} alternativa_pesimista_desfavorable$ValorOptimo`$.

#### Método optimista

```{r}
#| echo: true

alternativa_optimista_desfavorable <- criterio.Optimista(tabla_decision, favorable = FALSE)
```

Para el criterio `{r} alternativa_optimista_desfavorable$criterio`, en el caso `{r} alternativa_optimista_desfavorable$metodo`, la alternativa $`{r} alternativa_optimista_desfavorable$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} alternativa_optimista_desfavorable$ValorOptimo`$.

#### Método Hurwicz

```{r}
#| echo: true

alternativa_Hurwicz_desfavorable <- criterio.Hurwicz(tabla_decision, alfa = 0.5, favorable = FALSE)
alternativas_Hurwicz_alfas_desfavorable <- criterio.Hurwicz.General(tabla_decision, alfa = 10, favorable = FALSE)
tb_Hurwicz_desfavorable <- data.frame(matrix(c(
                  seq(from = 0, to = 1, by = (1/alternativas_Hurwicz_alfas_desfavorable$alfa)),
                  alternativas_Hurwicz_alfas_desfavorable$AlternativaOptima, 
                  alternativas_Hurwicz_alfas_desfavorable$ValorOptimo),
                  nrow = length(alternativas_Hurwicz_alfas_desfavorable$AlternativaOptima), 
                  byrow = FALSE, 
                  ))
colnames(tb_Hurwicz_desfavorable) <- c("Alfa", "Alternativa óptima", "Valor óptimo")
```

Para el criterio de `{r} alternativa_Hurwicz_desfavorable$criterio`, en el caso `{r} alternativa_Hurwicz_desfavorable$metodo`, la alternativa $`{r} alternativa_Hurwicz_desfavorable$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} alternativa_Hurwicz_desfavorable$ValorOptimo`$. Con un valor de $\alpha =$ $`{r} alternativa_Hurwicz_desfavorable$alfa`$.

Se muestra a continuación una tabla con las alternativas óptimas y los valores óptimos para diferentes valores de alfa, que van desde 0 hasta 1 con incrementos de 0.1:

`{r} crea_tabla_estilo(tb_Hurwicz_desfavorable, FALSE)`

Y gráficamente:

```{r}
#| echo: true

gráfico_Hurwicz_desfavorable <- dibuja.criterio.Hurwicz(tabla_decision, favorable = FALSE)
```

Además, se muestra un gráfico donde se pueden apreciar los intervalos de las alternativas óptimas para diferentes valores de alfa:

```{r}
#| echo: true

intervalos_Hurwicz_desfavorable <- dibuja.criterio.Hurwicz_Intervalos(tabla_decision, favorable = FALSE)

```

#### Método Savage

```{r}
#| echo: true

alternativa_Savage_desfavorable <- criterio.Savage(tabla_decision, favorable = FALSE)
```

Para el criterio de `{r} alternativa_Savage_desfavorable$criterio`, en el caso `{r} alternativa_Savage_desfavorable$metodo`, la alternativa $`{r} alternativa_Savage_desfavorable$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} alternativa_Savage_desfavorable$ValorOptimo`$.

#### Método Laplace

```{r}
#| echo: true

alternativa_Laplace_desfavorable <- criterio.Laplace(tabla_decision, favorable = FALSE)
```

Para el criterio de `{r} alternativa_Laplace_desfavorable$criterio`, en el caso `{r} alternativa_Laplace_desfavorable$metodo`, la alternativa $`{r} alternativa_Laplace_desfavorable$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} alternativa_Laplace_desfavorable$ValorOptimo`$.

#### Método punto ideal

```{r}
#| echo: true

alternativa_puntoideal_desfavorable <- criterio.PuntoIdeal(tabla_decision, favorable = FALSE)
```

Para el criterio de `{r} alternativa_puntoideal_desfavorable$criterio`, en el caso `{r} alternativa_puntoideal_desfavorable$metodo`, la alternativa $`{r} alternativa_puntoideal_desfavorable$AlternativaOpt`$ es la mejor y el valor óptimo es $`{r} round(alternativa_puntoideal_desfavorable$ValorOptimo,2)`$.

#### Resumen caso desfavorable

```{r}
#| echo: true


matriz_resumen_desfavorable <- matrix(c(
               alternativa_pesimista_desfavorable$criterio,
               alternativa_optimista_desfavorable$criterio,
               alternativa_Hurwicz_desfavorable$criterio,
               alternativa_Savage_desfavorable$criterio,
               alternativa_Laplace_desfavorable$criterio,
               alternativa_puntoideal_desfavorable$criterio,
               alternativa_pesimista_desfavorable$AlternativaOpt,
               alternativa_optimista_desfavorable$AlternativaOpt,
               alternativa_Hurwicz_desfavorable$AlternativaOpt,
               alternativa_Savage_desfavorable$AlternativaOpt,
               alternativa_Laplace_desfavorable$AlternativaOpt,
               alternativa_puntoideal_desfavorable$AlternativaOpt),
               nrow = 6, byrow = FALSE)

resumen_desfavorable <- as.data.frame(matriz_resumen_desfavorable)
colnames(resumen_desfavorable) <- c("Criterio", "Alternativa óptima")
crea_tabla_estilo(resumen_desfavorable, FALSE)

```

Vemos que las alternativas óptimas son diferentes según el criterio utilizado, siendo la alternativa $a_1$ la que más veces aparece como óptima (3 veces). La alternativa $a_4$ aparece en dos ocasiones como óptima, por último para el criterio pesimista la mejor alternativa es $a_5$ y es la mejor alternativa también para el criterio de Hurwicz con valores de $\alpha$ menores que `{r} intervalos_Hurwicz_desfavorable$PuntosDeCorte ` .

::: {.callout-tip}
## Decisión final
En este caso se va a optar por la alternativa $a_1$ dado que es la que mayor número de veces aparece como óptima y en el criterio de Hurwicz el gráfico nos muestra que es bastante equilibrada para todos los valores de alfa, aunque nunca sea la mejor.
:::

{{< pagebreak >}}

## Problema 4.2

Una persona recibe una herencia de 200.000 euros y se le presentan diferentes opciones de inversión para los próximos 10 años.

Puede terminar de pagar su hipoteca actual, ahorrando 40.000 euros de intereses y le sobrarían 30.000 euros que pondría en una cuenta remunerada al 2% anual

Puede seguir pagando su hipoteca y elegir una de las siguientes opciones

- Adquirir un piso por esa cantidad y si los alquileres turísticos siguen siendo posibles podrá generar un 6% anual. Si por el contrario se regularan pasaría a perder un 1% anual.
- Invertir en un fondo indexado que le puede generar un 7% anual pero si la bolsa baja perderá un 8%.
- Invertir en una franquicia de una cadena de comida rápida. Si acierta con el sitio podrá generar un 10% anual pero si se equivoca al seleccionar el sitio incurrirá en unas pérdidas anuales del 10%

### Planteamiento del problema

Alternativas

* a1: Pagar hipoteca
* a2: Adquirir piso
* a3: Invertir en un fondo
* a4: Invertir en una franquicia

Estados de la naturaleza

* e1: Regulación alquileres
* e2: No regulación alquileres
* e3: Bolsa sube
* e4: Bolsa baja
* e5: Acierta con la ubicación
* e6: Se equivoca con la ubicación

Ahora vamos a construir la matriz de decisión para un año. Puesto que los estados de la naturaleza afectan por parejas (e1-e2, e3-e4, e5-e6) a las alternativas (a2, a3, a4). Se van a reducir a que la inversión de cada alternativa salga bien o mal ese año.

* e1_red: Inversión exitosa
* e2_red: Inversión fallida

Puesto que la alternativa 1 no se ve afectada por los estados de la naturaleza esta alternativa tendrá valores fijos en todos ellos y no se ve alterada por esta reducción.

Vamos a hacer una tabla para un año y luego aplicaremos los criterios de decisión bajo incertidumbre para ver qué alternativa es la mejor.

```{r}

m11 <- 4000 + 30000 * 0.02
m12 <- 4000 + 30000 * 0.02

m21 <- 200000 * 0.06 - 4000
m22 <- -200000 * 0.01 - 4000

m31 <- 200000 * 0.07 - 4000
m32 <- -200000 * 0.08 - 4000

m41 <- 200000 * 0.1 - 4000
m42 <- -200000 * 0.1 - 4000

matriz_datos_2 <- matrix(c(m11, m12,
                      m21, m22,
                      m31, m32,
                      m41, m42),
                    nrow = 4,
                    byrow = TRUE)
tabla_datos_2 <- as.data.frame(matriz_datos_2)
colnames(tabla_datos_2) <- c("Inversión exitosa", "Inversión fallida")
rownames(tabla_datos_2) <- c("Pagar hipoteca",
                             "Aquirir piso",
                             "Invertir fondo",
                             "Invertir franquicia")
crea_tabla_estilo(tabla_datos_2, TRUE)
```

```{r}
# Definir la tabla de decisión
tabla_decision2 <- crea.tablaX(c(m11, m12,
                      m21, m22,
                      m31, m32,
                      m41, m42),
                      numalternativas = 4,
                      numestados = 2,
                      nb_alternativas = c("Pagar hipoteca",
                                          "Aquirir piso",
                                          "Invertir fondo",
                                          "Invertir franquicia"),
                      nb_estados = c("Inversión exitosa",
                                     "Inversión fallida"))
                      
```


### Resolución del problema

En la siguiente tabla se muestran los resultados de aplicar todos los criterios de decisión bajo incertidumbre para el caso favorable.
```{r}
resultado2 <- criterio.Todos(tabla_decision2, alfa = 0.5, favorable = TRUE)
res <- as.data.frame(resultado2)

crea_tabla_estilo(res, nombresfila = TRUE)
```

Observamos que para 4 de los 6 criterios la alternativa óptima es "Pagar hipoteca", siendo las otras dos alternativas óptimas "Invertir en una franquicia" para el criterio optimista y "Adquirir un piso" para el criterio de Hurwicz.

::: {.callout-tip}
## Decisión final
Se va a optar por la alternativa "Pagar hipoteca" ya que es la que más veces aparece como óptima y además es la opción más segura, ya que las demás alternativas conllevan un riesgo mayor de pérdida económica.
:::
>>>>>>> af97e053f40d66758ae6dd71a85a4fa0d0ecefa5
